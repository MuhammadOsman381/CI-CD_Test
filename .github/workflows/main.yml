name: Node.js CI/CD Pipeline

on:
  push:
    branches:
      - main 
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install

  deploy:
    runs-on: ubuntu-latest
    needs: build

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Deploy to EC2 via SSH
      uses: appleboy/ssh-action@v0.1.7
      with:
        host: ${{ secrets.EC2_HOST }}
        username: ubuntu
        key: ${{ -----BEGIN RSA PRIVATE KEY-----
LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBa29pcDBiaVJBR2d4THI2K3JuTUMyKzN0OTJocDdRSHdvSUs5cWUxYzZlWDNlUzRjCld1Yll6WFVIQlJwdUxLWFMrUDdUSk9rZnNLMUtOTmNTb0dRVHR1QzlwU0hxSDZZMXdzby83S1QxNFkxUEdDS1UKVEVOOVFxTmdYV0dJVjF3ajB0b2xjQVVIV2p0cnZ5R1YwbkNrRGY5dUV6am5YcGNGTmFMdnBkdXczMTUyT2s2LwpZUEkxbXBadU13azk3T2EwRUpYclNucUlsbHEyTkhBbEMrSE5yOTRlYit5MGdnQ3dqZjNvWUVzSkFjOTFBZHNoCjJHbTUxZjZ5NDhMNlh0RU01N2lTbHhMNUdYZzFzcWIzTHNqcHFqNDJDV2tQZmVuakpMSm1xdzlVakVWaGpubXAKVVRUOHVUTE9wRFBra1pzeXpSNlN1SXo2K25ZcTc0VnJHQUdxSndJREFRQUJBb0lCQUdQMjhZc09FM1dvbnV6WgoyYkdlNm5OcEJLK0V2c2FlVFM3aklrcWJrSWhNaHlCWFVhYTkxMmVLajZodW1IekMvNE00TElrQXRNck4zVkxnCjZtY2Evc3dDMDcya3ZsaXJCZ0FHQThnSDNXbnJBZXRnSTdWSFVWdTFveGJ4WTViZFY5OFBUUHozb1VWd1JoZ1UKN0dXc3pHNTBNLzdQRWlCWWZJaFR5Sk5vcFdncnUxQ2xpaFpPTWhWMnZhdmVHaExzc1hBbjFtMFl4eXhUcFVNYQpTUUhJeU5RNTlhb0dMSUZLaUYvOXBpaEUyQm5ORXlFL3FwOWJrSHZtclhlZjJnSkJWN0pSYzJnU3Q5c2kwcjBKCmlMLzVkelJIRDYzTUVnZVZRTkJ5TWN0dDZ4Mk43Zi9ZellaWkp1MkJuUTNnVVdiRWlDZFlzeGF3SDRNWUR3ZU4KUkhnd2Nma0NnWUVBemVUVDR4RDBYaFM4bmx3VHd3SWVhTTZOa1V2c3Nvc2hSOFd3RTRRbXZDVWVqMUJKUFdGQgpTSXlDSkY4eCtOUjBIQTlTQWtKZkh6MTRNUFhwYmE5SEJKdGdqQ2kwRjA3V1B6TnB5cWM1dkozL0JzQk5LUUhnCjVkODduSFY1alFIZnhhVFNCbXJZekY0SEZLNG1rT3MrN3BHeDhyRXMrVTZPT0dvKzNUUzQrYzBDZ1lFQXRqRzIKQVU3NStZT0xWbURJYzYzdHZzQWpmVEtaK1RleFhtZy9pejdnR0RJSU9qRHYvVHRnOHA4Yk9kREQ4M2d1bmZMVgpwVEJUUG1mbjNuRGxvNW1uR1BJRnU5d0oxR05UMkV5aHVsMEF4dkhjT3N1azVrd3JxY2lSL2dsbjBmUU9scy9zCmR5Y3BnMUN1L1dYdk1JNGlhd1VxbDJMY3pUNW45SW5SL2R4NTc4TUNnWUJMNkl0OThhaEdiMXJDLzZ1QmYreDYKTTN6YURxWHJoWVAxbEJyQWR6NVlxMDdEQTVTYy9wZzFDU2lLQkZiR0tIM09RbyszcVlTc1hkdE1JYjIzNUtGSQpQNGl1NCtyUmxRMUVLODViR3FBY3ZCdGovODN5eW5DQ0QzVkl6NzdLaitCU1c5dmE1ZFdjTXlabEozZXNnaTZuCmdpdWJFRnRHWndIa0pyZWFrbStJR1FLQmdHdjN0NGk4K1l2d2RVRUI1NmdOdVNiaUMrWGtkN1JsV1ptOW8zSnMKRnphZlo1cThaMnVrcFlZQjNZdDhlTEt1Vk1uTEh1cGVZZVpJZ3ZLaDZxUHhxVUV5STAyNVRxWHJHc1BDWGREbgp6azhYQXRCZzM5Nk40dzRoU3NyRlhoM2dTRWo4L0g5NzJMRDF2azF4KzdYRmRRWUFzTVczazJ1WmdOYzhXUkhjCmR2SXJBb0dCQUliNFltbEtOYTNweFRYSWZNL01ISlZpKzU1WW5pY1JaNTJwUS9ndFJhcDcyTjNXUzBKQTRraVIKOTNRUGlVeUV6L0VSc0FBRzhyWUJKSFBLZG53cTJ3OXEyV0dWZGxtL2YwQ1VsNWlRRzR2OTZURjlMcyt2VDhLMgpoWGJ4UDF2VFBHdEN2MzRpYTIwcGNFajNxc0tKdUh1V2pidkVTTFJSa1lNTEowTGM2UTVHCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t
-----END RSA PRIVATE KEY----- }}
        port: 22
        script: |
          cd /path/to/your/app
          git pull origin main
          npm install
          pm2 restart all || pm2 start npm --name "app-name" -- start
